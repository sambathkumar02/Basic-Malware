package main

import (
	"bufio"
	"fmt"
	"net"
)

func Shell(conn net.Conn) {
	//scanner:=bufio.NewReader(os.Stdin)
	defer conn.Close()
	for {
		fmt.Print("\n>")
		var data string
		fmt.Scan(&data)

		//_, err := conn.Write([]byte(data))
		fmt.Fprintf(conn, data+"\n")

		result, _ := bufio.NewReader(conn).ReadString('$')
		for string(result) == "" {
			result, _ = bufio.NewReader(conn).ReadString('$')
		}
		fmt.Print(result)

	}

}

func HandleConnection(conn net.Conn) {
	defer conn.Close()
	_, err := conn.Write([]byte("ls"))
	if err != nil {
		fmt.Print("send failed")
	}
}

func main() {
	server_connection, err := net.Listen("tcp", ":1234")
	if err != nil {
		fmt.Print("Server initialization failed")
	}
	fmt.Print("\nServer Listening")
	for {

		connection, err := server_connection.Accept()
		fmt.Print("\n Connection Details:", connection.LocalAddr())
		if err != nil {
			fmt.Print("Connection Failed")

		}
		Shell(connection)
	}
}
